<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="Bookmark" href="favicon.ico">
    <link rel="Shortcut Icon" href="favicon.ico"/>

    <link rel="stylesheet" type="text/css" href="/lib/h-ui/css/H-ui.min.css"/>
    <link rel="stylesheet" type="text/css" href="/lib/h-ui.admin/css/H-ui.admin.css"/>
    <link rel="stylesheet" type="text/css" href="/lib/iconfont/1.0.8/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="/lib/h-ui.admin/skin/default/skin.css" id="skin"/>
    <link rel="stylesheet" type="text/css" href="/lib/h-ui.admin/css/style.css"/>

    <title>添加用户</title>
    <style type="text/css">
        #dropzone {
            background: #cccccc;
            width: 150px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-weight: bold;
        }
        #dropzone.in {
            width: 600px;
            height: 200px;
            line-height: 200px;
            font-size: larger;
        }
        #dropzone.hover {
            background: lawngreen;
        }
        #dropzone.fade {
            -webkit-transition: all 0.3s ease-out;
            -moz-transition: all 0.3s ease-out;
            -ms-transition: all 0.3s ease-out;
            -o-transition: all 0.3s ease-out;
            transition: all 0.3s ease-out;
            opacity: 1;
        }
    </style>

</head>
<body>
<article class="cl pd-20">
    <form action="" method="post" class="form form-horizontal" id="form-user-add">
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>用户名：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input placeholder="用户名" type="text" class="input-text" value="" placeholder="" id="name" name="name">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>密码：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input placeholder="密码" type="text" class="input-text" value="" placeholder="" id="pwd" name="pwd">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>性别：</label>
            <div class="formControls col-xs-8 col-sm-9 skin-minimal">
                <div class="radio-box">
                    <input value="1" name="sex" type="radio" id="sex-1">
                    <label for="sex-1">男</label>
                </div>
                <div class="radio-box">
                    <input value="2" name="sex" type="radio" id="sex-2">
                    <label for="sex-2">女</label>
                </div>
            </div>

        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">头像：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input id="fileupload" type="file" name="files[]" data-url="/tool/fileUpload" multiple>
                <div id="dropzone">Drop files here</div>

                <div id="progress">
                    <div style="width: 0%;"></div>
                </div>

                <table id="uploaded-files">
                    <tr>
                        <th>File Name</th>
                        <th>File Size</th>
                        <th>File Type</th>
                        <th>Download</th>
                    </tr>
                </table>
            </div>
        </div>
        <div class="row cl" style="margin-top: 218px">
            <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
                <input style="float: right" class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
            </div>
        </div>
    </form>
</article>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="/lib/util.js"></script>
<script type="text/javascript" src="https://js.love-baby.vip/jquery.min.js"></script>
<script type="text/javascript" src="https://js.love-baby.vip/jquery.cookie.js"></script>
<script type="text/javascript" src="/lib/layer/layer.js"></script>
<script type="text/javascript" src="/lib/h-ui/js/H-ui.js"></script>
<script type="text/javascript" src="/lib/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="/lib/My97DatePicker/WdatePicker.js"></script>


<!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="/lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="/lib/jquery.validation/1.14.0/messages_zh.js"></script>


<script src="/lib/jquery-file-upload-9.22.0/js/vendor/jquery.ui.widget.js"></script>
<script src="/lib/jquery-file-upload-9.22.0/js/jquery.iframe-transport.js"></script>
<script src="/lib/jquery-file-upload-9.22.0/js/jquery.fileupload.js"></script>


<script type="text/javascript">
    $(function () {

        //上传文件
        $('#fileupload').fileupload({
            dataType: 'json',
            done: function (e, data) {
                $("tr:has(td)").remove();
                $.each(data.result, function (index, file) {

                    $("#uploaded-files").append(
                        $('<tr/>')
                            .append($('<td/>').text(file.fileName))
                            .append($('<td/>').text(file.fileSize))
                            .append($('<td/>').text(file.fileType))
                            .append($('<td/>').html("<a href='rest/controller/get/" + index + "'>Click</a>"))
                    )//end $("#uploaded-files").append()
                });
            },

            progressall: function (e, data) {
                var progress = parseInt(data.loaded / data.total * 100, 10);
                $('#progress .bar').css(
                    'width',
                    progress + '%'
                );
            },
            dropZone: $('#dropzone')
        });

        var id = location.search.substring(1);//获取查询串
        if (id != "" && id != null) {
            $.ajax({
                type: "GET",
                url: host + "/user/userInfo/" + id,
                headers: {
                    'token': $.cookie('token')
                },
                dataType: "json",
                success: function (data) {
                    if (data.code == 500) {
                        window.location = "/login.html";
                    } else if (data.code == 200) {
                        if (data.data != null) {
                            $("#name").val(data.data.name);
                            $("#pwd").val(data.data.pwd);
                            $("input[name='sex'][value=" + data.data.sex + "]").attr("checked", true);
                            $("input[name='sex'][value=" + data.data.sex + "]").parent().addClass("checked");
                            $("#avatar").val(data.data.avatar);
                        }

                    } else {
                        layer.msg(data.message);
                    }
                }
            });
        }
        $('.skin-minimal input').iCheck({
            checkboxClass: 'icheckbox-blue',
            radioClass: 'iradio-blue',
            increaseArea: '20%'
        });

        $("#form-user-add").validate({
            rules: {
                name: {
                    required: true
                },
                sex: {
                    required: true
                },
                pwd: {
                    required: true,
                    isPwd: true
                },
                avatar: {
                    required: true
                }

            },
            onkeyup: false,
            focusCleanup: true,
            success: "valid",
            submitHandler: function () {
                var user = {
                    "name": $("#name").val(),
                    "pwd": $("#pwd").val(),
                    "sex": $("input[name='sex']:checked").val(),
                    "avatar": $("#avatar").val()
                };
                var url = host + "/user";
                if (id != "" && id != null) {
                    url = host + "/user/update";
                    user.id = id;
                }
                $.ajax({
                    async: false,
                    type: "PUT",
                    url: url,
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(user),
                    dataType: "json",
                    headers: {
                        'token': $.cookie('token')
                    },
                    success: function (data) {
                        if (data.code == 200) {
                            parent.layer.msg("提交成功");
                        } else {
                            parent.layer.msg(data.message);
                        }
                    },
                    error: function () {
                        parent.layer.msg("提交成功");
                    }
                });
                var index = parent.layer.getFrameIndex(window.name);
                parent.$('.btn-refresh').click();
                parent.layer.close(index);
            }
        });
    });
</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>