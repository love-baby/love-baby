<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="Bookmark" href="favicon.ico">
    <link rel="Shortcut Icon" href="favicon.ico"/>

    <link rel="stylesheet" type="text/css" href="/lib/h-ui/css/H-ui.min.css"/>
    <link rel="stylesheet" type="text/css" href="/lib/h-ui.admin/css/H-ui.admin.css"/>
    <link rel="stylesheet" type="text/css" href="/lib/iconfont/1.0.8/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="/lib/h-ui.admin/skin/default/skin.css" id="skin"/>
    <link rel="stylesheet" type="text/css" href="/lib/h-ui.admin/css/style.css"/>
    <!--音乐播放器-->
    <link rel="stylesheet" href="https://css.love-baby.vip/mplayer.min.css">
    <title>音乐列表 - 音乐管理</title>

</head>
<body>
<article class="cl pl-20 pr-20 pt-5">

    <div class="cl pd-5 bg-1 bk-gray mt-20">
            <span class="l">
                    <a href="javascript:;" onclick="datadeAll()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a>
                    <a href="javascript:;" onclick="add('添加','/module/music/music-add.html','','510')" class="btn btn-primary radius"><i class="Hui-iconfont">&#xe600;</i> 添加</a>
                <a href="javascript:;" onclick="add('批量添加','/module/music/music-add-batch.html','','510')" class="btn btn-primary radius"><i class="Hui-iconfont">&#xe600;</i> 批量添加</a>
            </span>
        <span class="r">
                <div class="text-c"> 日期范围：
                    <input type="text" onfocus="WdatePicker({maxDate:'#F{$dp.$D(\'dateMax\')||\'%y-%M-%d\'}'})" id="dateMin" class="input-text Wdate" style="width:120px;">
                    -
                    <input type="text" onfocus="WdatePicker({minDate:'#F{$dp.$D(\'dateMin\')}',maxDate:'%y-%M-%d'})" id="dateMax" class="input-text Wdate" style="width:120px;">
                    <input type="text" class="input-text" style="width:250px" placeholder="歌曲名称，歌手，专辑" id="searchText">
                    <button type="submit" class="btn btn-success radius" id="btn_search" name="btn_search"><i class="Hui-iconfont">&#xe665;</i> 搜</button>
                </div>
        </span>
    </div>
    <div class="mt-20">
        <table id="userTable" class="table table-border table-bordered table-hover table-bg table-sort" style="width: 100%">
        </table>
    </div>
</article>

<script type="text/javascript" src="https://js.love-baby.vip/jquery.min.js"></script>
<script type="text/javascript" src="https://js.love-baby.vip/jquery.cookie.js"></script>
<script type="text/javascript" src="/lib/layer/layer.js"></script>
<script type="text/javascript" src="https://js.love-baby.vip/H-ui.js"></script>
<script type="text/javascript" src="/lib/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="https://js.love-baby.vip/iconfont.js"></script>


<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="https://js.love-baby.vip/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/lib/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="/lib/util.js"></script>


<script type="text/javascript">
    $(function () {
        $('#userTable').DataTable({
            "bFilter": false,//关闭搜索
            "bProcessing": true,//是否显示取数据时的那个等待提示
            "serverSide": true,//启用服务器端分页
            "sAjaxSource": host + "/music/listAll",
            "bAutoWidth": true,
            "fnServerData": function (sSource, aoData, fnCallback) {
                aoData.push(
                    {"name": "searchText", "value": $('#searchText').val()},
                    {"name": "dateMin", "value": $('#dateMin').val()},
                    {"name": "dateMax", "value": $('#dateMax').val()}
                );
                $.ajax({
                    headers: {
                        'token': $.cookie('token')
                    },
                    async: false,
                    type: 'post',
                    url: sSource,
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(aoData),
                    success: function (resp) {
                        if (resp.code == 200) {
                            fnCallback(resp.data);
                        } else {
                            layer.msg("查询失败");
                        }
                    }, error: function () {
                        layer.msg("查询失败");
                    }

                });
            },
            "aoColumnDefs": [{"bSortable": false, "aTargets": [0, 5]}],
            "aaSorting": [[4, "desc"]],
            "aoColumns": [
                {
                    "data": null,
                    "sTitle": "序号",
                    "width": "30px",
                    "render": function (data, type, row, meta) {
                        var startIndex = meta.settings._iDisplayStart;
                        return startIndex + meta.row + 1;
                    }
                },
                {
                    "mDataProp": "name",
                    "sTitle": "歌名",
                    "sDefaultContent": "",
                    "sClass": "center"
                }, {
                    "mDataProp": "author.name",
                    "sTitle": "歌手",
                    "sDefaultContent": "",
                    "sClass": "center"
                }, {
                    "mDataProp": "album.name",
                    "sTitle": "专辑",
                    "sDefaultContent": "",
                    "sClass": "center"
                }, {
                    "mDataProp": "createTime",
                    "sTitle": "创建时间",
                    "sDefaultContent": "",
                    "sClass": "center"
                }, {
                    "data": null,
                    "orderable": false,
                    "title": "操作",
                    "render": function (data, type, row, meta) {
                        return '<a title="编辑" href="javascript:;" onclick="edit(\'编辑\',\'/module/music/music-add.html\',\'' + data.id + '\',\'\',550)" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6df;</i></a>'
                            + '<a title="删除" href="javascript:;" onclick="deleteById(this,\'' + data.id + '\')" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6e2;</i></a>'
                            + '<a title="试听" href="javascript:;" onclick="audition(this,\'' + data.id + '\')" class="ml-5" style="text-decoration:none"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-shiting"></use></svg></a>';
                    }
                }
            ],
            language: {
                "sProcessing": "处理中...",
                "sLengthMenu": "显示 _MENU_ 项结果",
                "sZeroRecords": "没有匹配结果",
                "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
                "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
                "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
                "sInfoPostFix": "",
                "sSearch": "搜索:",
                "sUrl": "",
                "sEmptyTable": "表中数据为空",
                "sLoadingRecords": "载入中...",
                "sInfoThousands": ",",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上页",
                    "sNext": "下页",
                    "sLast": "末页"
                },
                "oAria": {
                    "sSortAscending": ": 以升序排列此列",
                    "sSortDescending": ": 以降序排列此列"
                }
            }
        });

    });

    /**
     * 搜索
     **/
    $('#btn_search').click(function () {
        var table = $('#userTable').DataTable();
        table.draw();
    });


    function add(title, url, w, h) {
        layer_show(title, url, w, h);
    }

    function edit(title, url, id, w, h) {
        layer_show(title, url + "?" + id, w, h);
    }

    function deleteById(obj, id) {
        layer.confirm('确认要删除吗？', function (index) {
            $.ajax({
                type: "delete",
                url: host + "/music/" + id,
                headers: {
                    'token': $.cookie('token')
                },
                datatype: "json",
                success: function (data) {
                    if (data.code == 500) {
                        window.location = "/login.html";
                    } else if (data.code == 200) {
                        $(obj).parents("tr").remove();
                        layer.msg('已删除!', {icon: 1, time: 1000});
                    } else {
                        layer.msg(data.message);
                    }
                }
            });

        });
    }

    /**
     * 多条删除
     */
    function datadeAll() {
        layer.confirm('确认要删除吗？', function (index) {
            var vals = [];
            $("#fileTable tbody input:checkbox:checked").each(function (index, item) {
                vals.push($(this).val());
            });
            $.ajax({
                type: "delete",
                url: host + "/music/list",
                headers: {
                    'token': $.cookie('token')
                },
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                data: JSON.stringify(vals),
                success: function (data) {
                    if (data.code == 500) {
                        window.location = "/login.html";
                    } else if (data.code == 200) {
                        layer.msg('已删除!', {icon: 1, time: 1000});
                        var table = $('#fileTable').DataTable();
                        table.draw();
                        $("#selectAll").prop('checked', false);
                    } else {
                        layer.msg(data.message);
                    }
                }
            });
        });
    }

    var mplayer_song = [[
        {
            "basic": true,
            "name": "试听列表",
            "singer": "love",
            "img": "https://images.love-baby.vip/20181010180902.png"
        },
        {
            "name": "童话镇",
            "singer": "陈一发儿",
            "img": "https://images.love-baby.vip/20181010180902.png",
            "src": "http://img.love-baby.vip/data/resource/love-baby/upload/2018-09-15/1536984833498_eed1c35bcdd918cefc67801ce3aab1c6.flac",
            "lrc": "[ti:童话镇]\n[ar:陈一发儿]\n[al:童话镇]\n[by:]\n[offset:0]\n[00:00.00]童话镇\n" +
                "[00:05.00]演唱：陈一发\n" +
                "[00:10.00]作曲 : 暗杠\n" +
                "[00:15.00]作词 : 竹君\n" +
                "[00:22.93]听说白雪公主在逃跑\n" +
                "[00:26.43] 小红帽在担心大灰狼\n" +
                "[00:29.83]听说疯帽喜欢爱丽丝 \n" +
                "[00:33.17]丑小鸭会变成白天鹅\n" +
                "[00:36.34]听说彼得潘总长不大\n" +
                "[00:40.23]杰克他有竖琴和魔法\n" +
                "[00:43.56]听说森林里有糖果屋\n" +
                "[00:46.82]灰姑娘丢了心爱的玻璃鞋\n" +
                "[00:50.39]只有睿智的河水知道\n" +
                "[00:53.68]白雪是因为贪玩跑出了城堡\n" +
                "[00:57.31]小红帽有件抑制自己\n" +
                "[01:00.73]变成狼的大红袍\n" +
                "[01:03.80]总有一条蜿蜒在童话镇里七彩的河\n" +
                "[01:11.00]沾染魔法的乖张气息\n" +
                "[01:14.42]却又在爱里曲折\n" +
                "[01:17.76]川流不息扬起水\n" +
                "[01:20.87]又卷入一帘时光入水\n" +
                "[01:24.68]让全部很久很久以前\n" +
                "[01:28.12]都走到幸福结局的时刻\n" +
                "[01:33.18]music....\n" +
                "[01:47.00]听说睡美人被埋藏\n" +
                "[01:50.44]小人鱼在眺望金殿堂\n" +
                "[01:53.79]听说阿波罗变成金乌\n" +
                "[01:57.12]草原有奔跑的剑齿虎\n" +
                "[02:00.73]听说匹诺曹总说着谎\n" +
                "[02:04.16]侏儒怪拥有宝石满箱\n" +
                "[02:07.57]听说悬崖有颗长生树\n" +
                "[02:10.80]红鞋子不知疲倦地在跳舞\n" +
                "[02:14.43]只有睿智的河水知道\n" +
                "[02:17.84]睡美人逃避了生活的煎熬\n" +
                "[02:21.14]小人鱼把阳光抹成眼影\n" +
                "[02:24.58]投进泡沫的怀抱\n" +
                "[02:27.77]总有一条蜿蜒在童话镇里七彩的河\n" +
                "[02:35.06]沾染魔法的乖张气息\n" +
                "[02:38.43]却又在爱里曲折\n" +
                "[02:41.82]川流不息扬起水花\n" +
                "[02:44.87]又卷入一帘时光入水\n" +
                "[02:48.69]让全部很久很久以前\n" +
                "[02:52.00]都走到幸福结局的时刻\n" +
                "[02:55.46]总有一条蜿蜒在童话镇里梦幻的河\n" +
                "[03:02.47]分隔了理想分隔现实\n" +
                "[03:05.82]又在前方的山口汇合\n" +
                "[03:09.22]川流不息扬起水花\n" +
                "[03:12.36]又卷入一帘时光入水\n" +
                "[03:16.23]让全部很久很久以前\n" +
                "[03:19.38]都走到幸福结局的时刻\n" +
                "[03:22.72]又陌生\n" +
                "[03:24.52]啊~~啊~~啊~~啊~~\n"
        }
    ]];

    function audition(obj, id) {
        $.ajax({
            type: "GET",
            url: host + "/music/audition/" + id,
            headers: {
                'token': $.cookie('token')
            },
            dataType: "json",
            success: function (data) {
                if (data.code == 500) {
                    window.location = "/login.html";
                } else if (data.code == 200) {
                    if (data.data != null) {
                        mplayer_song[0].push(data.data);
                        setEffects(player);
                    }
                } else {
                    parent.layer.msg(data.message);
                }
            }
        });
    }

</script>
<!--/请在上方写此页面业务相关的脚本-->


<div class="mp">
    <div class="mp-box">
        <img src="img/mplayer_error.png" alt="music cover" class="mp-cover">
        <div class="mp-info">
            <p class="mp-name">燕归巢</p>
            <p class="mp-singer">许嵩</p>
            <p><span class="mp-time-current">00:00</span>/<span class="mp-time-all">00:00</span></p>
        </div>
        <div class="mp-btn">
            <button class="mp-prev" title="上一首"></button>
            <button class="mp-pause" title="播放"></button>
            <button class="mp-next" title="下一首"></button>
            <button class="mp-mode" title="播放模式"></button>
            <div class="mp-vol">
                <button class="mp-vol-img" title="静音"></button>
                <div class="mp-vol-range" data-range_min="0" data-range_max="100" data-cur_min="80">
                    <div class="mp-vol-current"></div>
                    <div class="mp-vol-circle"></div>
                </div>
            </div>
        </div>
        <div class="mp-pro">
            <div class="mp-pro-current"></div>
        </div>
        <div class="mp-menu">
            <button class="mp-list-toggle"></button>
            <button class="mp-lrc-toggle"></button>
        </div>
    </div>
    <button class="mp-toggle">
        <span class="mp-toggle-img"></span>
    </button>
    <div class="mp-lrc-box">
        <ul class="mp-lrc"></ul>
    </div>
    <button class="mp-lrc-close"></button>
    <div class="mp-list-box">
        <ul class="mp-list-title"></ul>
        <table class="mp-list-table">
            <thead>
            <tr>
                <th>歌名</th>
                <th>歌手</th>
                <th>时长</th>
            </tr>
            </thead>
            <tbody class="mp-list"></tbody>
        </table>
    </div>
</div>
<!--音乐播发器-->
<script src="https://js.love-baby.vip/mplayer.min.js"></script>
<!--<script src="/lib/MPlayer/js/mplayer-list.js"></script>-->
<script src="https://js.love-baby.vip/mplayer-functions.js"></script>
<script src="https://js.love-baby.vip/jquery.nstSlider.min.js"></script>
<script>


    var modeText = ['顺序播放', '单曲循环', '随机播放', '列表循环'];
    var player = new MPlayer({
        // 容器选择器名称
        containerSelector: '.mp',
        // 播放列表
        songList: mplayer_song,
        // 专辑图片错误时显示的图片
        defaultImg: 'https://images.love-baby.vip/mplayer_error.png',
        // 自动播放
        autoPlay: true,
        // 播放模式(0->顺序播放,1->单曲循环,2->随机播放,3->列表循环(默认))
        playMode: 0,
        playList: 0,
        playSong: 0,
        // 当前歌词距离顶部的距离
        lrcTopPos: 34,
        // 列表模板，用${变量名}$插入模板变量
        listFormat: '<tr><td>${name}$</td><td>${singer}$</td><td>${time}$</td></tr>',
        // 音量滑块改变事件名称
        volSlideEventName: 'change',
        // 初始音量
        defaultVolume: 80
    }, function () {
        // 绑定事件
        this.on('afterInit', function () {
            console.log('播放器初始化完成，正在准备播放');
        }).on('beforePlay', function () {
            var $this = this;
            var song = $this.getCurrentSong(true);
            var songName = song.name + ' - ' + song.singer;
            console.log('即将播放' + songName + '，return false;可以取消播放');
        }).on('timeUpdate', function () {
            var $this = this;
            console.log('当前歌词：' + $this.getLrc());
        }).on('end', function () {
            var $this = this;
            var song = $this.getCurrentSong(true);
            var songName = song.name + ' - ' + song.singer;
            console.log(songName + '播放完毕，return false;可以取消播放下一曲');
        }).on('mute', function () {
            var status = this.getIsMuted() ? '已静音' : '未静音';
            console.log('当前静音状态：' + status);
        }).on('changeMode', function () {
            var $this = this;
            var mode = modeText[$this.getPlayMode()];
            $this.dom.container.find('.mp-mode').attr('title', mode);
            console.log('播放模式已切换为：' + mode);
        });
    });


    $(document.body).append(player.audio); // 测试用

    setEffects(player);


</script>

</body>
</html>