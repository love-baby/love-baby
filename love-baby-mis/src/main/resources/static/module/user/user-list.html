<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="Bookmark" href="favicon.ico">
    <link rel="Shortcut Icon" href="favicon.ico"/>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="lib/html5.js"></script>
    <script type="text/javascript" src="lib/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/static/h-ui/css/H-ui.min.css"/>
    <link rel="stylesheet" type="text/css" href="/static/h-ui.admin/css/H-ui.admin.css"/>
    <link rel="stylesheet" type="text/css" href="/lib/Hui-iconfont/1.0.8/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="/static/h-ui.admin/skin/default/skin.css" id="skin"/>
    <link rel="stylesheet" type="text/css" href="/static/h-ui.admin/css/style.css"/>
    <!--[if IE 6]>
    <script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js"></script>
    <script>DD_belatedPNG.fix('*');</script><![endif]-->

    <title>用户列表 - 用户管理</title>
</head>
<body>
<article class="cl pl-20 pr-20 pt-5">

    <div class="cl pd-5 bg-1 bk-gray mt-20">
            <span class="l">
                    <a href="javascript:;" onclick="datadel()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a>
                    <a href="javascript:;" onclick="user_add('添加用户','/module/user/user-add.html','','510')" class="btn btn-primary radius"><i class="Hui-iconfont">&#xe600;</i> 添加用户</a>
            </span>
        <span class="r">
                <div class="text-c"> 日期范围：
                    <input type="text" onfocus="WdatePicker({maxDate:'#F{$dp.$D(\'dateMax\')||\'%y-%M-%d\'}'})" id="dateMin" class="input-text Wdate" style="width:120px;">
                    -
                    <input type="text" onfocus="WdatePicker({minDate:'#F{$dp.$D(\'dateMin\')}',maxDate:'%y-%M-%d'})" id="dateMax" class="input-text Wdate" style="width:120px;">
                    <input type="text" class="input-text" style="width:250px" placeholder="输入会员名称" id="searchText">
                    <button type="submit" class="btn btn-success radius" id="btn_search" name="btn_search"><i class="Hui-iconfont">&#xe665;</i> 搜用户</button>
                </div>
        </span>
    </div>
    <div class="mt-20">
        <table id="userTable" class="table table-border table-bordered table-hover table-bg table-sort" style="width: 100%">
        </table>
    </div>
</article>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="/static/h-ui/js/H-ui.js"></script>
<script type="text/javascript" src="/static/h-ui.admin/js/H-ui.admin.page.js"></script>
<!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="/lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/lib/laypage/1.2/laypage.js"></script>
<script type="text/javascript" src="/js/util.js"></script>
<script type="text/javascript">
    $(function () {
        $('#userTable').DataTable({
            "bFilter": false,//关闭搜索
            "bProcessing": true,//是否显示取数据时的那个等待提示
            "serverSide": true,//启用服务器端分页
            "sAjaxSource": host + "/user/listAll",
            "bAutoWidth" : true,
            "fnServerData": function (sSource, aoData, fnCallback) {
                aoData.push(
                    {"name": "searchText", "value": $('#searchText').val()},
                    {"name": "dateMin", "value": $('#dateMin').val()},
                    {"name": "dateMax", "value": $('#dateMax').val()}
                );
                $.ajax({
                    headers: {
                        'token': $.cookie('token')
                    },
                    async: false,
                    type: 'post',
                    url: sSource,
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(aoData),
                    success: function (resp) {
                        if (resp.code == 200) {
                            fnCallback(resp.data);
                        } else {
                            layer.msg("查询失败");
                        }
                    }, error: function () {
                        layer.msg("查询失败");
                    }

                });
            },
            "aoColumnDefs": [{"bSortable": false, "aTargets": [0, 5]}],
            "aaSorting": [[4, "desc"]],
            "aoColumns": [
                {
                    "mDataProp": "id",
                    "title": "序号",
                    "defaultContent": "",
                    "sClass": "center"
                },
                {
                    "mDataProp": "name",
                    "sTitle": "用户名",
                    "sDefaultContent": "",
                    "sClass": "center"
                }, {
                    "mDataProp": "sex.name",
                    "sTitle": " 性别",
                    "sDefaultContent": "",
                    "sClass": "center"
                }, {
                    "mDataProp": "avatar",
                    "sTitle": "头像",
                    "sDefaultContent": "",
                    "sClass": "center"
                }, {
                    "mDataProp": "createTime",
                    "sTitle": "创建时间",
                    "sDefaultContent": "",
                    "sClass": "center"
                }, {
                    "data": null,
                    "orderable": false,
                    "title": "操作",
                    "render": function (data, type, row, meta) {
                        return '<a title="编辑" href="javascript:;" onclick="user_edit(\'编辑\',\'/module/user/user-add.html\',\'' + data.id + '\',\'\',500)" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6df;</i></a>'
                            + '<a title="删除" href="javascript:;" onclick="user_delete(this,\'' + data.id + '\')" class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6e2;</i></a>';
                    }
                }
            ],
            columns: [
                {data: 'name'},
                {data: 'sex.name'},
                {data: 'avatar'},
                {data: 'createTime'}
            ],
            language: {
                "sProcessing": "处理中...",
                "sLengthMenu": "显示 _MENU_ 项结果",
                "sZeroRecords": "没有匹配结果",
                "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
                "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
                "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
                "sInfoPostFix": "",
                "sSearch": "搜索:",
                "sUrl": "",
                "sEmptyTable": "表中数据为空",
                "sLoadingRecords": "载入中...",
                "sInfoThousands": ",",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上页",
                    "sNext": "下页",
                    "sLast": "末页"
                },
                "oAria": {
                    "sSortAscending": ": 以升序排列此列",
                    "sSortDescending": ": 以降序排列此列"
                }
            }
        });

    });

    /**
     * 搜索
     **/
    $('#btn_search').click(function () {
        var table = $('#userTable').DataTable();
        table.draw();
    });


    /*用户-添加*/
    function user_add(title, url, w, h) {
        layer_show(title, url, w, h);
    }

    /*用户-编辑*/
    function user_edit(title, url, id, w, h) {
        layer_show(title, url + "?" + id, w, h);
    }

    /*用户-删除*/
    function user_delete(obj, id) {
        layer.confirm('确认要删除吗？', function (index) {
            $.ajax({
                type: "delete",
                url: host + "/user/" + id,
                headers: {
                    'token': $.cookie('token')
                },
                datatype: "json",
                success: function (data) {
                    if (data.code == 500) {
                        window.location = "/login.html";
                    } else if (data.code == 200) {
                        $(obj).parents("tr").remove();
                        layer.msg('已删除!', {icon: 1, time: 1000});
                    } else {
                        layer.msg(data.message);
                    }
                }
            });

        });
    }
</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>