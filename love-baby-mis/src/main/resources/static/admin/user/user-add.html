<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="Bookmark" href="favicon.ico">
    <link rel="Shortcut Icon" href="favicon.ico"/>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="lib/html5.js"></script>
    <script type="text/javascript" src="lib/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="/static/h-ui/css/H-ui.min.css"/>
    <link rel="stylesheet" type="text/css" href="/static/h-ui.admin/css/H-ui.admin.css"/>
    <link rel="stylesheet" type="text/css" href="/lib/Hui-iconfont/1.0.8/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="/static/h-ui.admin/skin/default/skin.css" id="skin"/>
    <link rel="stylesheet" type="text/css" href="/static/h-ui.admin/css/style.css"/>
    <!--[if IE 6]>
    <script type="text/javascript" src="/static/h-ui/js/DD_belatedPNG_0.0.8a-min.js"></script>
    <script>DD_belatedPNG.fix('*');</script><![endif]-->
    <!--/meta 作为公共模版分离出去-->

    <title>添加用户</title>

</head>
<body>
<article class="cl pd-20">
    <form action="" method="post" class="form form-horizontal" id="form-user-add">
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>用户名：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input placeholder="用户名" type="text" class="input-text" value="" placeholder="" id="name" name="name">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>密码：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input placeholder="密码" type="text" class="input-text" value="" placeholder="" id="pwd" name="pwd">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"><span class="c-red">*</span>性别：</label>
            <div class="formControls col-xs-8 col-sm-9 skin-minimal">
                <div class="radio-box">
                    <input value="1" name="sex" type="radio" id="sex-1">
                    <label for="sex-1">男</label>
                </div>
                <div class="radio-box">
                    <input value="2" name="sex" type="radio" id="sex-2">
                    <label for="sex-2">女</label>
                </div>
            </div>

        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">头像：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="btn-upload form-group">
                    <input class="input-text upload-url" type="text" name="avatar" id="avatar" readonly nullmsg="请上传头像！" style="width:200px">
                    <a href="javascript:void();" class="btn btn-primary radius upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>
                <input id="file" name="file" type="file" multiple class="input-file">
                </span>
            </div>
        </div>
        <div class="row cl" style="margin-top: 218px">
            <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
                <input style="float: right" class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
            </div>
        </div>
    </form>
</article>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="/js/util.js"></script>
<script type="text/javascript" src="/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="/js/ajaxfileupload.js"></script>
<script type="text/javascript" src="/static/h-ui/js/H-ui.js"></script>
<script type="text/javascript" src="/static/h-ui.admin/js/H-ui.admin.page.js"></script>
<!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="/lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="/lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="/lib/jquery.validation/1.14.0/messages_zh.js"></script>

<script type="text/javascript">
    $(function () {
        var id = location.search.substring(1);//获取查询串
        if (id != "" && id != null) {
            $.ajax({
                type: "GET",
                url: host + "/user/userInfo/" + id,
                headers: {
                    'token': $.cookie('token')
                },
                datatype: "json",
                success: function (data) {
                    if (data.code == 500) {
                        window.location = "/login.html";
                    } else if (data.code == 200) {
                        if (data.data != null) {
                            $("#name").val(data.data.name);
                            $("#pwd").val(data.data.pwd);
                            $("input[name='sex'][value=" + data.data.sex + "]").attr("checked",true);
                            $("input[name='sex'][value=" + data.data.sex + "]").parent().addClass("checked");
                            $("#avatar").val(data.data.avatar);
                        }

                    } else {
                        layer.msg(data.message);
                    }
                }
            });
        }
        $('.skin-minimal input').iCheck({
            checkboxClass: 'icheckbox-blue',
            radioClass: 'iradio-blue',
            increaseArea: '20%'
        });

        $("#form-user-add").validate({
            rules: {
                name: {
                    required: true
                },
                sex: {
                    required: true
                },
                pwd: {
                    required: true,
                    isPwd: true
                },
                avatar: {
                    required: true
                },

            },
            onkeyup: false,
            focusCleanup: true,
            success: "valid",
            submitHandler: function () {
                var user = {
                    "name": $("#name").val(),
                    "pwd": $("#pwd").val(),
                    "sex": $("input[name='sex']:checked").val(),
                    "avatar": $("#avatar").val()
                };
                var url = host + "/user";
                if (id != "" && id != null) {
                    url = host + "/user/update";
                    user.id = id;
                }
                $.ajax({
                    async: false,
                    type: "PUT",
                    url: url,
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(user),
                    dataType: "json",
                    headers: {
                        'token': $.cookie('token')
                    },
                    success: function (data) {
                        if (data.code == 200) {
                            parent.layer.msg("提交成功");
                        } else {
                            parent.layer.msg(data.message);
                        }
                    },
                    error: function () {
                        parent.layer.msg("提交成功");
                    }
                });
                var index = parent.layer.getFrameIndex(window.name);
                parent.$('.btn-refresh').click();
                parent.layer.close(index);
            }
        });
    });
</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>